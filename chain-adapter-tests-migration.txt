# Chain Adapter Tests Migration Progress

## Ethereum_Adapter

**Date**: 2026-01-07
**Status**: Completed

### Tests Migrated

| # | Hardhat Test Name | Foundry Test Name |
|---|------------------|-------------------|
| 1 | relayMessage calls spoke pool functions | test_relayMessage_CallsSpokePoolFunctions |
| 2 | Correctly transfers tokens when executing pool rebalance | test_relayTokens_TransfersTokensOnPoolRebalance |

### Mocks Used

- `MockSpokePool` from `contracts/test/MockSpokePool.sol` - Deployed as UUPS proxy via `ERC1967Proxy`

### New Mocks/Utilities Created

- None - used existing MockSpokePool

### Deviations from Original

- None significant. The Foundry test additionally verifies the DAI token balance change after pool rebalance execution.

### Notes

- Ethereum_Adapter is a pass-through adapter for same-chain communication (HubPool to Ethereum_SpokePool)
- The adapter's `relayMessage` directly calls the target contract
- The adapter's `relayTokens` uses safeTransfer to send tokens
- No external bridge mocks are needed as this is L1-to-L1 communication
- HubPool must be the owner of MockSpokePool since the adapter calls target directly via delegatecall context, and MockSpokePool's `_requireAdminSender` is `onlyOwner`
- MockSpokePool requires UUPS proxy deployment pattern: `new ERC1967Proxy(address(new MockSpokePool(weth)), abi.encodeCall(MockSpokePool.initialize, (...)))`
- Address constants used instead of inline `makeAddr()` calls

---

## Arbitrum_SendTokensAdapter

**Date**: 2026-01-07
**Status**: Completed

### Tests Migrated

| # | Hardhat Test Name | Foundry Test Name |
|---|------------------|-------------------|
| 1 | relayMessage sends desired ERC20 in specified amount to SpokePool | test_relayMessage_SendsDesiredERC20InSpecifiedAmountToSpokePool |

### Mocks Used

- `ArbitrumMockErc20GatewayRouter` from `contracts/test/ArbitrumMocks.sol`

### New Mocks/Utilities Created

- None - used existing ArbitrumMocks.sol

### Deviations from Original

- None. The test verifies the same behavior: event emission, ETH balance change, and WETH allowance set.

### Notes

- Arbitrum_SendTokensAdapter is an emergency adapter for sending tokens from HubPool to SpokePool
- Unlike the main Arbitrum_Adapter, this only implements `relayMessage` (not `relayTokens`)
- The message format is `abi.encode(address token, uint256 amount)`
- Uses `relaySpokePoolAdminFunction` instead of `executeRootBundle`
- The adapter approves the gateway (obtained via `getGateway`), not the router itself
- Constants match the adapter: `l2MaxSubmissionCost = 0.01 ether`, `l2GasPrice = 5 gwei`, `RELAY_TOKENS_L2_GAS_LIMIT = 300_000`

---
